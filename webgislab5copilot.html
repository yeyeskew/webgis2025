<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLayers Basemap & WMS Viewer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v8.2.0/ol.css">
    <style>
        /* Apply Inter font and basic styling */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }
        #map {
            width: 100%;
            height: calc(100vh - 8rem); /* Adjust height to accommodate header/controls */
        }
        /* Custom styling for the overlay control panel */
        #layer-control {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-50">

    <header class="p-4 bg-white shadow-md">
        <h1 class="text-2xl font-bold text-gray-800">Geospatial Layer Manager</h1>
        <p class="text-sm text-gray-600">Switch between basemaps and toggle the WMS overlay.</p>
    </header>

    <!-- Map Container -->
    <div id="map" class="shadow-xl rounded-lg overflow-hidden"></div>

    <!-- Layer Control Panel -->
    <div id="layer-control" class="p-4 bg-white bg-opacity-95 shadow-2xl rounded-lg flex flex-col space-y-3">
        
        <h3 class="text-lg font-semibold text-gray-700 border-b pb-2">Layers</h3>

        <!-- Basemap Selector (Radio Buttons) -->
        <fieldset class="space-y-2">
            <legend class="text-sm font-medium text-gray-900 mb-1">Basemaps (Select One)</legend>
            <div class="flex items-center">
                <input id="basemap-osm" name="basemaps" type="radio" checked
                       class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" value="osm">
                <label for="basemap-osm" class="ml-3 text-sm font-medium text-gray-700">OpenStreetMap</label>
            </div>
            <div class="flex items-center">
                <input id="basemap-esri" name="basemaps" type="radio"
                       class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500" value="esri">
                <label for="basemap-esri" class="ml-3 text-sm font-medium text-gray-700">ESRI World Imagery</label>
            </div>
        </fieldset>

        <!-- WMS Overlay Toggle (Checkbox) -->
        <div class="pt-2 border-t">
            <legend class="text-sm font-medium text-gray-900 mb-1">Overlay</legend>
            <div class="relative flex items-start">
                <div class="flex items-center h-5">
                    <input id="overlay-wms" type="checkbox" checked
                           class="h-4 w-4 rounded border-gray-300 text-green-600 focus:ring-green-500">
                </div>
                <div class="ml-3 text-sm">
                    <label for="overlay-wms" class="font-medium text-gray-700">GeoServer US States (WMS)</label>
                </div>
            </div>
        </div>
    </div>

    <!-- OpenLayers JS -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v8.2.0/dist/ol.js"></script>

    <script>
        // Use a self-executing function to avoid global namespace pollution
        (function() {
            // --- 1. Define Layers ---

            // 1.1. OpenStreetMap Basemap Layer
            const osmLayer = new ol.layer.Tile({
                title: 'OpenStreetMap',
                type: 'base',
                visible: true,
                source: new ol.source.OSM()
            });

            // 1.2. ESRI World Imagery Basemap Layer
            const esriImageryLayer = new ol.layer.Tile({
                title: 'ESRI World Imagery',
                type: 'base',
                visible: false,
                source: new ol.source.XYZ({
                    attributions:
                        'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
                    maxZoom: 19
                })
            });

            // 1.3. WMS Overlay Layer (topp:states)
            const wmsLayer = new ol.layer.Tile({
                title: 'GeoServer US States WMS',
                visible: true, // Default to visible
                source: new ol.source.TileWMS({
                    url: 'https://ahocevar.com/geoserver/wms',
                    params: {
                        'LAYERS': 'topp:states',
                        'TILED': true,
                        'VERSION': '1.1.1' // Using the version specified in the request
                    },
                    serverType: 'geoserver'
                })
            });

            // Group all layers
            const layerGroup = new ol.layer.Group({
                layers: [
                    osmLayer,
                    esriImageryLayer,
                    wmsLayer
                ]
            });


            // --- 2. Initialize Map ---

            // Initial center for the continental US (where the WMS layer is visible)
            const initialCenter = ol.proj.fromLonLat([-98.5, 39.8]);

            const map = new ol.Map({
                target: 'map',
                layers: [layerGroup],
                view: new ol.View({
                    center: initialCenter,
                    zoom: 4,
                    minZoom: 2,
                    maxZoom: 20
                })
            });


            // --- 3. Handle User Interaction (Layer Switching) ---

            const basemapInputs = document.querySelectorAll('input[name="basemaps"]');
            const wmsCheckbox = document.getElementById('overlay-wms');

            /**
             * Handles switching between base layers by setting visibility.
             */
            const handleBasemapChange = (event) => {
                const selectedValue = event.target.value;

                if (selectedValue === 'osm') {
                    osmLayer.setVisible(true);
                    esriImageryLayer.setVisible(false);
                } else if (selectedValue === 'esri') {
                    osmLayer.setVisible(false);
                    esriImageryLayer.setVisible(true);
                }
            };

            /**
             * Handles toggling the visibility of the WMS overlay.
             */
            const handleWMSOverlayChange = (event) => {
                wmsLayer.setVisible(event.target.checked);
            };

            // Attach event listeners
            basemapInputs.forEach(input => {
                input.addEventListener('change', handleBasemapChange);
            });

            wmsCheckbox.addEventListener('change', handleWMSOverlayChange);

            // Set initial state for WMS layer (since the checkbox starts checked)
            wmsLayer.setVisible(wmsCheckbox.checked);

        })();
    </script>

</body>
</html>
